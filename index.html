<!DOCTYPE html>
<html>
<head>
  <title>FibAlgo Indicator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <style>
    canvas { border: 2px solid #fff; }
    body { margin: 0; background: #000; color: #fff; font-family: Arial, sans-serif; }
  </style>
</head>
<body>
  <h1 style="padding: 10px;">FibAlgo Indicator</h1>
  <script>
    let data = [
      { time: 9, price: 3.394 },
      { time: 10, price: 3.388 },
      { time: 11, price: 3.382 },
      { time: 12, price: 3.378 },
      { time: 13, price: 3.384 },
      { time: 14, price: 3.392 },
      { time: 15, price: 3.405 }
    ];

    function setup() {
      createCanvas(600, 400); // Larger canvas for clarity
      pixelDensity(2); // Sharper rendering
      background(0);
      textSize(14);
      textFont('Arial'); // Clean, professional font
      textAlign(LEFT, CENTER);
    }

    function draw() {
      background(0);

      // Draw X-axis (time)
      stroke(180); // Lighter gray for subtlety
      strokeWeight(2);
      line(80, 350, 520, 350);
      for (let t = 9; t <= 15; t++) {
        let x = map(t, 9, 15, 80, 520);
        text(t + ":00", x - 15, 360);
      }

      // Draw Y-axis (price)
      line(80, 50, 80, 350);
      for (let p = 3.37; p <= 3.41; p += 0.01) {
        let y = map(p, 3.41, 3.37, 50, 350);
        if (p % 0.02 === 0) text(p.toFixed(2), 60, y + 5);
      }

      // Draw candlesticks
      strokeWeight(2);
      data.forEach((d, i) => {
        let x = map(d.time, 9, 15, 80, 520);
        let yOpen = map(d.price, 3.41, 3.37, 50, 350);
        let yClose = map(data[i + 1] ? data[i + 1].price : d.price, 3.41, 3.37, 50, 350);
        let yHigh = map(Math.max(d.price, data[i + 1] ? data[i + 1].price : d.price), 3.41, 3.37, 50, 350);
        let yLow = map(Math.min(d.price, data[i + 1] ? data[i + 1].price : d.price), 3.41, 3.37, 50, 350);

        stroke(255, 0, 0);
        let isUp = d.price < (data[i + 1] ? data[i + 1].price : d.price);
        fill(isUp ? [0, 180, 0] : [180, 0, 0]); // Softer colors
        line(x, yHigh, x, yLow);
        if (yClose !== yOpen) {
          rect(x - 10, min(yOpen, yClose), 20, abs(yOpen - yClose));
        }
      });

      // Draw Fibonacci levels
      strokeWeight(1.5);
      stroke(100, 0, 100); // Darker purple
      let swingHigh = 3.405;
      let swingLow = 3.378;
      let range = swingHigh - swingLow;
      let fibLevels = [0.382, 0.5, 1.382, 1.5];
      fibLevels.forEach(level => {
        let y = map(swingLow + range * level, 3.41, 3.37, 50, 350);
        line(80, y, 520, y);
        noStroke();
        fill(180); // Lighter text for contrast
        text(`${(level * 100).toFixed(0)}%`, 525, y - 5);
      });

      // Shade and label Perfect Sell Zone (0.382-0.5)
      let sellStartY = map(swingLow + range * 0.382, 3.41, 3.37, 50, 350);
      let sellEndY = map(swingLow + range * 0.5, 3.41, 3.37, 50, 350);
      noStroke();
      fill(255, 0, 0, 30); // Very light red
      rect(80, sellStartY, 440, sellEndY - sellStartY);
      fill(255);
      textSize(12);
      text("Sell Zone: 38.2%-50% (Prob: 13%, Conf: 27.3% FAIR)", 10, sellStartY + 10);

      // Shade and label Perfect Buy Zone (1.382-1.5)
      let buyStartY = map(swingLow + range * 1.382, 3.41, 3.37, 50, 350);
      let buyEndY = map(swingLow + range * 1.5, 3.41, 3.37, 50, 350);
      fill(0, 255, 0, 30); // Very light green
      rect(80, buyStartY, 440, buyEndY - buyStartY);
      fill(255);
      textSize(12);
      text("Buy Zone: 138.2%-150% (Prob: 5%, Conf: 100% EXCELLENT)", 10, buyStartY + 10);

      // Add trend lines
      strokeWeight(2);
      stroke(255, 0, 0); // Red
      line(80, map(3.394, 3.41, 3.37, 50, 350), 520, map(3.405, 3.41, 3.37, 50, 350));
      stroke(255, 255, 0); // Yellow
      line(80, map(3.378, 3.41, 3.37, 50, 350), 520, map(3.392, 3.41, 3.37, 50, 350));
    }
  </script>